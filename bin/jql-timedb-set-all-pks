#! /usr/local/bin/python3

import json

from timedb import pks


def main():
    with open("schema2.json") as f:
        snapshot = json.load(f)
    db = pks.TimeDB(snapshot)
    for current_pk, task in list(snapshot['tasks'].items()):
        correct_pk = pks.pk_for_task(task, None)
        if current_pk != correct_pk:
            db.update_task_pk(current_pk, correct_pk)
    with open("schema2.json", 'w') as f:
        json.dump(snapshot, f, sort_keys=True, indent=4, separators=(",", ": "))


if __name__ == "__main__":
    main()
